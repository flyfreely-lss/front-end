# 最佳实践

* 可维护的代码
* 保证代码性能
* 部署代码 　

## 24.1 可维护性

### 24.1.1 什么是可维护的代码

1. 代码是可维护的，它需要遵循以下特点:
* 可理解性——其他人可以接手代码并理解它的意图和一般途径，而无需原开发人员的完整解释。
* 直观性——代码中的东西一看就能明白，不管其操作过程多么复杂。
* 可适应性——代码以一种数据上的变化不要求完全重写的方法撰写。
* 可扩展性——在代码架构上已考虑到在未来允许对核心功能进行扩展。
* 可调试性——当有地方出错时，代码可以给予你足够的信息来尽可能直接地确定问题所在。

### 24.1.2 代码约定

1. 一种让代码变得可维护的简单途径是形成一套JavaScript代码的书写约定。

2. 代码约定的概论：
* 可读性，可读性一方面和代码的缩进相关，另一方面是注释。

* 变量和函数命名。

* 变量类型透明

3. 对于2中可读性注释，一般而言，有如下一些地方需要进行注释。
* 函数和方法——如参数代表什么，函数是否有返回值（因为这不能从函数定义中推断出来）。
* 大段代码。
* 复杂的算法。
* Hack。

4. 对于2中变量和函数命名规则如下：
* 变量名应为名词如car或person。
* 函数名应该以动词开始，如getName()。返回布尔类型值的函数一般以is开头，如isEnable()。
* 变量和函数都应使用合乎逻辑的名字，不要担心长度。长度问题可以通过后处理和压缩来缓解。
有了合适的命名，代码阅读起来就像讲述故事一样，更容易理解。

5. 对于2中变量类型透明,有三种表示变量数据类型的方式。
* 第一种方式是初始化。当定义了一个变量后，它应该被初始化为一个值，来暗示它将来应该如何应用。(缺点是它无法用于函数声明中的函数参数。)
* 第二种方法是使用匈牙利标记法来指定变量类型(缺点是让代码某种程度上难以阅读，阻碍了没有用它时代码的直观性和句子式的特质)，例如：
```
//用于指定数据类型的匈牙利标记法
var bFound;         //布尔型
var iCount;         //整数
var sName;          //字符串
var oPerson;        //对象
```
* 最后一种指定变量类型的方式是使用类型注释(缺点是你不能用多行注释一次注释大块的代码，因为类型注释也是多行注释，两者会冲突)，例如：
```
//用于指定类型的类型注释
var found  /*:Boolean*/  = false;
var count  /*:int*/      = 10;
var name   /*:String*/   = "Nicholas";
var person /*:Object*/   = null;
```


### 24.1.3 松散耦合

1. 维护弱耦合代码的着手方面：

* 解耦HTML/JavaScript。

  HTML是`数据`，JavaScript是`行为`。

  HTML呈现应该尽可能与JavaScript保持分离。当JavaScript用于插入数据时，尽量不要直接插入标记。一般可以在页面中直接包含并隐藏标记，然后等到整个页面渲染好之后，就可以用JavaScript显示该标记，而非生成它。另一种方法是进行Ajax请求并获取更多要显示的HTML，这个方法可以让同样的渲染层（PHP、JSP、Ruby等等）来输出标记，而不是直接嵌在JavaScript中。

* 解耦CSS/JavaScript。

  `显示`问题的唯一来源应该是CSS，`行为`问题的唯一来源应该是JavaScript。

* 解耦应用逻辑/事件处理程序。

  应用和业务逻辑之间松散耦合的几条原则：

  a) 勿将event对象传给其他方法；只传来自event对象中所需的数据；

  b) 任何可以在应用层面的动作都应该可以在不执行任何事件处理程序的情况下进行；

  c) 任何事件处理程序都应该处理事件，然后将处理转交给应用逻辑。

### 24.1.4 编程实践

1. 在企业中创建Web应用坚持以下编程实践：
* 尊重对象所有权

  最佳的方法便是永远不修改不是由你所有的对象。

* 避免全局量

  单一的全局量的延伸便是命名空间的概念，由YUI（Yahoo! User Interface）库普及。命名空间包括创建一个用于放置功能的对象。在YUI的2.x版本中，有若干用于追加功能的命名空间。比如：

  a) `YAHOO.util.Dom`—— 处理DOM的方法；

  b) `YAHOO.util.Event`—— 与事件交互的方法；

  c) `YAHOO.lang`—— 用于底层语言特性的方法。

  对于YUI，单一的全局对象YAHOO作为一个容器，其中定义了其他对象。用这种方式将功能组合在一起的对象，叫做`命名空间`。

* 避免与null进行比较

  现实中，与null比较很少适合情况而被使用。必须按照所期望的对值进行检查，而非按照不被期望的那些。

  如果看到了与null比较的代码，尝试使用以下技术替换：

  a) 如果值应为一个引用类型，使用instanceof操作符检查其构造函数；

  b) 如果值应为一个基本类型，使用typeof检查其类型；

  c) 如果是希望对象包含某个特定的方法名，则使用typeof操作符确保指定名字的方法存在于对象上。

* 使用常量

  常量使用场合：

  a) `重复值`——任何在多处用到的值都应抽取为一个常量。这就限制了当一个值变了而另一个没变的时候会造成的错误。这也包含了`CSS类名`。

  b) `用户界面字符串`—— 任何用于显示给用户的字符串，都应被抽取出来以方便国际化。

  c) `URLs`—— 在Web应用中，资源位置很容易变更，所以推荐用一个公共地方存放所有的URL。

  d) `任意可能会更改的值`—— 每当你在用到字面量值的时候，你都要问一下自己这个值在未来是不是会变化。如果答案是“是”，那么这个值就应该被提取出来作为一个常量。

## 24.2 性能

### 24.2.1 注意作用域

1. 避免全局查找。将在一个函数中会用到多次的全局对象存储为局部变量总是没错的。

2. 避免with语句。和函数类似，with语句会创建自己的作用域，因此会增加其中执行的代码的作用域链的长度。

### 24.2.2 选择正确方法

1. 避免不必要的属性查找

  | 标记 | 名称 | 描述 |
  | -------- | ---- | ----------------------------------------------------------------- |
  | O(1)     | 常数  | 不管有多少值，执行的时间都是恒定的。一般表示简单值和存储在变量中的值          |
  | O(log n) | 对数  | 总的执行时间和值的数量相关，但是要完成算法并不一定要获取每个值。例如：二分查找  |
  | O(n)     | 线性  | 总执行时间和值的数量直接相关。例如：遍历某个数组中的所有元素                 |
  | O(n2)    | 平方  | 总执行时间和值的数量有关，每个值至少要获取n次。例如：插入排序                |

  使用变量和数组要比访问对象上的属性更有效率，后者是一个O(n)操作。对象上的任何属性查找都要比访问变量或者数组花费更长时间，因为必须在原型链中对拥有该名称的属性进行一次搜索。

  一般来讲，只要能减少算法的复杂度，就要尽可能减少。尽可能多地使用局部变量将属性查找替换为值查找。进一步讲，如果即可以用数字化的数组位置进行访问，也可以使用命名属性（诸如NodeList对象），那么使用数字位置。

2. 优化循环

  一个循环的基本优化步骤如下:

  a) 减值迭代——大多数循环使用一个从0开始、增加到某个特定值的迭代器。在很多情况下，从最大值开始，在循环中不断减值的迭代器更加高效。

  b) 简化终止条件——由于每次循环过程都会计算终止条件，所以必须保证它尽可能快。也就是说避免属性查找或其他O(n)的操作。

  c) 简化循环体——循环体是执行最多的，所以要确保其被最大限度地优化。确保没有某些可以被很容易移出循环的密集计算。

  d) 使用后测试循环——最常用for循环和while循环都是前测试循环。而如do-while这种后测试循环，可以避免最初终止条件的计算，因此运行更快。

  后测试循环代码举例：
  ```
  // 使用“后测试”循环时必须确保要处理的值至少有一个。空数组会导致多余的一次循环而“前测试”循环则可以避免。
  var i = values.length - 1;
  if (i > -1) {
    do {
      process(values[i]);
    } while (--i >= 0);
  }
  ```


3. 展开循环


4. 避免双重解释

5. 性能的其他注意事项


## 24.3 部署
## 24.4 小结